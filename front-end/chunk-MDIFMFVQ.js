import{a as Se}from"./chunk-XMRAJODF.js";import{a as xe}from"./chunk-XHNQRRQK.js";import{b as ve}from"./chunk-CFHKRXTB.js";import{a as Ie,b as D}from"./chunk-P4PAYY2C.js";import{d as de,e as ce,f as fe,g as he,i as be,j as Ce,k as we,m as Pe,p as ye}from"./chunk-A6SNVUCE.js";import{a as ne,b as re,c as ae,d as le,g as se,h as pe,k as me,l as ue,n as _e,o as ge}from"./chunk-TWZKI4VX.js";import{a as ke}from"./chunk-V45YFJOR.js";import{b as J,d as $,e as K,f as Q,o as ee,r as te,y as ie,z as oe}from"./chunk-VE3AD5Y3.js";import{h as j,i as Z,j as H,n as Y,o as G,p as q}from"./chunk-QSIHMZNO.js";import{Cb as h,Db as g,Gb as T,Mb as z,Nb as P,Ob as k,Pb as V,Rb as v,Sb as I,Tb as S,Vb as U,Wb as M,Ya as p,Za as E,_b as R,dc as B,e as Ve,ec as X,f as b,fc as F,ia as A,jb as x,mb as W,nb as d,qb as L,sa as u,ta as _,tb as a,ub as l,vb as y,zb as w}from"./chunk-II3ZEASU.js";var Te=Ve(ke());var Be=()=>({"min-width":"50rem"}),De=()=>[5,10,20,50,100],Ne=()=>["nombre_prod","precio_prod"],Fe=()=>({width:"50vw"}),Oe=()=>({"960px":"75vw"}),Ae=(r,c,o,e)=>({outofstockzero:r,outofstock:c,lowstock:o,instock:e});function We(r,c){if(r&1){let o=w();a(0,"p-button",34),h("onClick",function(){u(o);let i=g(2);return _(i.descargarCSV(i.info,"Informe"))}),l()}if(r&2){let o=g(2);d("disabled",o.loading)}}function Le(r,c){if(r&1){let o=w();a(0,"p-button",35),h("onClick",function(){u(o);let i=g(2);return _(i.descargarExcel())}),l()}if(r&2){let o=g(2);d("disabled",o.loading)}}function ze(r,c){if(r&1){let o=w();a(0,"div",27)(1,"span",28),y(2,"i",29),a(3,"input",30),h("input",function(i){u(o),g();let t=z(2);return _(t.filterGlobal(i.target.value,"contains"))}),l()(),a(4,"p-button",31),h("onClick",function(){u(o);let i=g();return _(i.open())}),l(),x(5,We,1,1,"p-button",32)(6,Le,1,1,"p-button",33),l()}if(r&2){let o=g();p(4),d("raised",!0)("loading",o.loading)("disabled",o.loading),p(),d("ngIf",o.info),p(),d("ngIf",o.info)}}function Ue(r,c){if(r&1&&(a(0,"th",37),P(1),y(2,"p-sortIcon",38),l()),r&2){let o=c.$implicit;T("pSortableColumn",o.field),p(),V("",o.header," "),p(),T("field",o.field)}}function Re(r,c){if(r&1&&(a(0,"tr"),x(1,Ue,3,3,"th",36),l()),r&2){let o=c.$implicit;p(),d("ngForOf",o)}}function Xe(r,c){if(r&1){let o=w();a(0,"tr",39)(1,"td",40),P(2),l(),a(3,"td",40)(4,"div",41),P(5),l()(),a(6,"td",40),P(7),B(8,"number"),l(),a(9,"td",40),P(10),B(11,"percent"),l(),a(12,"td",40),P(13),B(14,"number"),l(),a(15,"td",40)(16,"p-button",42),h("onClick",function(){let i=u(o).$implicit,t=g();return _(t.openUpdate(i))}),l(),a(17,"p-button",43),h("onClick",function(){let i=u(o).$implicit,t=g();return _(t.deleteProd(i.id_prod))}),l()()()}if(r&2){let o=c.$implicit;p(2),k(o.nombre_prod),p(2),d("ngClass",R(16,Ae,o.cant_prod===0,o.cant_prod>0&&o.cant_prod<10,o.cant_prod>=10&&o.cant_prod<20,o.cant_prod>=20)),p(),V(" ",o.cant_prod," "),p(2),V("L. ",F(8,8,o.precio_prod,"1.2-2"),""),p(3),k(X(11,11,o.impuesto)),p(3),V("L. ",F(14,13,o.ganancia_prod,"1.2-2"),""),p(3),d("rounded",!0),p(),d("rounded",!0)}}function je(r,c){if(r&1&&(a(0,"tr")(1,"td")(2,"h4"),P(3,"No hay productos"),l()()()),r&2){let o=c.$implicit;p(),W("colspan",o.length)}}function Ze(r,c){if(r&1&&(a(0,"div",44)(1,"h4"),P(2),l()()),r&2){let o=g();p(2),k(o.titleModal)}}function He(r,c){if(r&1){let o=w();a(0,"p-button",49),h("onClick",function(){u(o);let i=g(2);return _(i.agregarProd())}),l()}if(r&2){let o=g(2);T("label",o.textBottom),d("raised",!0)}}function Ye(r,c){if(r&1){let o=w();a(0,"p-button",50),h("onClick",function(){u(o);let i=g(2);return _(i.editarProd())}),l()}if(r&2){let o=g(2);T("label",o.textBottom),d("raised",!0)}}function Ge(r,c){if(r&1){let o=w();x(0,He,1,2,"p-button",45)(1,Ye,1,2,"p-button",46),a(2,"p-button",47),h("onClick",function(){u(o);let i=g();return _(i.clean())}),l(),a(3,"p-button",48),h("onClick",function(){u(o);let i=g();return _(i.closeDialog())}),l()}if(r&2){let o=g();d("ngIf",o.op=="Add"),p(),d("ngIf",o.op=="Edit"),p(),T("label",o.btnClean),d("raised",!0),p(),d("raised",!0)}}var f=Te.default.mixin({showClass:{popup:`
      animate__animated
      animate__fadeInUp
      animate__faster
    `},hideClass:{popup:`
      animate__animated
      animate__fadeOutDown
      animate__faster
    `}}),yt=(()=>{let c=class c{constructor(e,i,t,m){this.api=e,this.apiImp=i,this.spinner=t,this.primengConfig=m,this.fileName="Informe.xlsx",this.imp=null,this.filas=0,this.columnas=[],this.info=[],this.infoImp=[],this.loading=!1,this.titleModal="Agregar Producto",this.textBottom="Agregar",this.lbBtnModal="Cancelar",this.btnClean="Limpiar",this.op="Add",this.href="",this.visible=!1,this.gancProdDis=!0,this.iconoNoImg=`${window.location.href}assets/img/no-image-icon.png`,this.idProd=0,this.nombreProd="",this.filas=10,this.columnas=[{field:"nombre_prod",header:"Nombre"},{field:"cant_prod",header:"Cant"},{field:"precio_prod",header:"Costo"},{field:"imp_prod",header:"Impuesto"},{field:"ganancia_prod",header:"Utilidad"},{field:"",header:"Acciones"}]}ngOnInit(){return b(this,null,function*(){this.primengConfig.ripple=!0,this.load(!0),yield this.poblarTabla(),yield this.listarImp(),this.load(!1)})}poblarTabla(){return b(this,null,function*(){this.load(!0),this.api.getProducts().subscribe(e=>b(this,null,function*(){this.info=e}),e=>{f.fire("Error!",`${e.message}`,"error")},()=>this.load(!1))})}open(){this.clean(),this.titleModal="Agregar Producto",this.textBottom="Agregar",this.op="Add",this.showDialog()}openUpdate(e){this.titleModal="Editar Producto",this.textBottom="Editar",this.op="Edit",this.idProd=e.id_prod,this.nombreProd=e.nombre_prod,this.precioProd=e.precio_prod,this.cantProd=e.cant_prod,this.imp=e.imp_prod,this.gancProd=e.ganancia_prod,this.showDialog()}handleOnChange(e){if(e.value&&this.precioProd){let i=this.infoImp[this.infoImp.findIndex(t=>t.id==e.value)];this.gancProd=this.precioProd*i.impuesto}}handleOnChangeInput(e){if(e.value&&this.imp){let i=this.infoImp[this.infoImp.findIndex(t=>t.id==this.imp)];this.gancProd=Number(e.value)*i.impuesto}}listarImp(){return b(this,null,function*(){this.load(!0),this.listImp=[{value:null,label:"Seleccione Impuesto"}],this.apiImp.getImpuesto().subscribe(e=>{for(let i=0;i<e.length;i++)this.listImp.push({value:e[i].id,label:e[i].descripcion+" - %"+(e[i].impuesto*100).toString()});this.infoImp=e,this.imp=this.listImp[0].value},e=>{f.fire("Error!",`${e.message}`,"error")},()=>this.load(!1))})}agregarProd(){return b(this,null,function*(){if(this.nombreProd==""||this.precioProd==null||this.cantProd==0||this.imp==null||this.gancProd==null)f.fire({position:"bottom-end",icon:"warning",title:"Debe llenar los campos obligatorios(Nombre, Costo, Cantidad, Impuesto y Utilidad)!",showConfirmButton:!1,timer:2e3,toast:!0});else if(this.info.findIndex(e=>e.nombre_prod===this.nombreProd)!=-1)f.fire({position:"bottom-end",icon:"warning",title:"Ya tiene registrado este producto!",showConfirmButton:!1,timer:2e3,toast:!0});else{let e={nombre_prod:this.nombreProd,cant_prod:this.cantProd,precio_prod:this.precioProd,imp_prod:this.imp,ganancia_prod:this.gancProd};this.load(!0),this.api.insertProd(e).subscribe(i=>{i.status?f.fire({position:"top-end",icon:"success",title:i.mgs,showConfirmButton:!1,timer:2e3}).then(()=>b(this,null,function*(){yield this.poblarTabla(),this.clean()})):f.fire("Cuidado!",i.mgs,"warning")},i=>{f.fire("Error!",`${i.message}`,"error")},()=>(this.load(!1),this.closeDialog()))}})}editarProd(){return b(this,null,function*(){if(this.idProd==0||this.nombreProd==""||this.precioProd==null||this.cantProd==0||this.imp==null||this.gancProd==null)f.fire({position:"bottom-end",icon:"warning",title:"Debe llenar los campos obligatorios(Nombre, Costo, Cantidad, Impuesto y Utilidad)!",showConfirmButton:!1,timer:2e3,toast:!0});else{let e=this.info.findIndex(i=>i.nombre_prod===this.nombreProd);if(e!=-1&&this.info[e].id_prod!=this.idProd)f.fire({position:"bottom-end",icon:"warning",title:"Ya tiene registrado este producto!",showConfirmButton:!1,timer:2e3,toast:!0});else{let i={nombre_prod:this.nombreProd,cant_prod:this.cantProd,precio_prod:this.precioProd,imp_prod:this.imp,ganancia_prod:this.gancProd};this.load(!0),this.api.updateProd(this.idProd,i).subscribe(t=>{t.status?f.fire({position:"top-end",icon:"success",title:t.mgs,showConfirmButton:!1,timer:2e3}).then(()=>b(this,null,function*(){yield this.poblarTabla(),this.clean()})):f.fire("Cuidado!",t.mgs,"warning")},t=>{f.fire("Error!",`${t.message}`,"error")},()=>(this.load(!1),this.closeDialog()))}}})}deleteProd(e){return b(this,null,function*(){f.fire({title:"Esta seguro de realizar esta accion?",text:"Se va a eliminar el Producto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",confirmButtonColor:"#d33",cancelButtonText:"Cancelar",cancelButtonColor:"#B9B6B5"}).then(i=>b(this,null,function*(){i.value&&(this.load(!0),this.api.deleteProd(e).subscribe(t=>{t.status?f.fire({position:"top-end",icon:"success",title:t.mgs,showConfirmButton:!1,timer:2e3}).then(()=>b(this,null,function*(){yield this.poblarTabla()})):(f.fire("Cuidado!",t.mgs,"warning"),this.poblarTabla())},t=>{f.fire("Error!",`${t.message}`,"error")},()=>(this.load(!1),this.closeDialog())))}))})}clean(){this.nombreProd="",this.precioProd=0,this.cantProd=1,this.imp=this.listImp[0].value,this.gancProd=0}ConvertToCSV(e,i,t){let m=typeof e!="object"?JSON.parse(e):e,s="",n="";for(let C in i)n+=i[C]+", ";n=n.replace(/,\s*$/,""),s+=n+`\r
`;for(let C=0;C<m.length;C++){let N="",O=0;for(let Me in t){let Ee=t[Me];N+=(O!=0?", ":"")+m[C][Ee],O++}s+=N+`\r
`}return s}descargarCSV(e,i="data"){let t=this.ConvertToCSV(e,["Nombre","Cantidad","Costo","Impuesto","Utilidad","Fecha"],["nombre_prod","cant_prod","precio_prod","imp_prod","ganancia_prod","fecha_prod"]),m=new Blob(["\uFEFF"+t],{type:"text/csvcharset=utf-8"}),s=document.createElement("a"),n=URL.createObjectURL(m);navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&s.setAttribute("target","_blank"),s.setAttribute("href",n),s.setAttribute("download",i+".csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}descargarExcel(){let e=new Array,i="";this.info.forEach(s=>{i=this.formatearFecha(new Date(s.fecha_prod));let n={nombre_prod:s.nombre_prod,cant_prod:s.cant_prod,precio_prod:s.precio_prod,imp_prod:s.impuesto,ganancia_prod:s.ganancia_prod,fecha_prod:i.fecha};e.push(n)});let t=D.json_to_sheet(e);t.A1.v="Nombre",t.B1.v="Cantidad",t.C1.v="Costo",t.D1.v="Impuesto",t.E1.v="Utilidad",t.F1.v="Fecha";let m=D.book_new();D.book_append_sheet(m,t,"Informe Productos"),Ie(m,this.fileName)}formatearFecha(e){let i=this.addZero(e.getHours()),t=this.addZero(e.getMinutes()),m=this.addZero(e.getSeconds()),s=e.getFullYear(),n=this.addZero(e.getMonth()+1),C=this.addZero(e.getDate());return{completo:s+"-"+n+"-"+C+" "+i+":"+t+":"+m,fecha:s+"-"+n+"-"+C,hora:i+":"+t+":"+m}}addZero(e){return e<10&&(e="0"+e),e}showDialog(){this.visible=!0}closeDialog(){this.visible=!1}load(e){e?(this.loading=!0,this.spinner.show()):(this.loading=!1,this.spinner.hide())}};c.\u0275fac=function(i){return new(i||c)(E(xe),E(Se),E(ne),E(ee))},c.\u0275cmp=A({type:c,selectors:[["app-productos"]],standalone:!0,features:[U],decls:34,vars:38,consts:[["dt",""],[1,"card",2,"text-align","center"],["styleClass","p-datatable-gridlines p-datatable-striped","columnResizeMode","expand","currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} productos","scrollHeight","300px",3,"tableStyle","value","rows","loading","columns","paginator","showCurrentPageReport","resizableColumns","rowsPerPageOptions","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["bdColor","rgba(0, 0, 0, 0.8)","size","large","color","#fff","type","ball-atom",3,"fullScreen"],["header","Header",3,"visibleChange","visible","modal","baseZIndex","breakpoints","draggable","resizable"],["ng-template","","pTemplate","header"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],[1,"p-inputgroup"],["tooltipPosition","bottom","pTooltip","Nombre",1,"p-inputgroup-addon"],[1,"pi","pi-shopping-cart"],["type","text","pInputText","","placeholder","Nombre",3,"ngModelChange","ngModel"],["appendTo","body","filterBy","label","placeholder","Seleccione Impuesto",3,"ngModelChange","onChange","options","ngModel","filter","showClear"],[1,"field","col-12","md:col-4"],["tooltipPosition","bottom","pTooltip","Cantidad",1,"p-inputgroup-addon"],[1,"pi","pi-plus-circle"],["placeholder","Cantidad",3,"ngModelChange","showButtons","min","max","ngModel"],["tooltipPosition","bottom","pTooltip","Costo",1,"p-inputgroup-addon"],[1,"pi","pi-money-bill"],["mode","decimal","locale","en-US","placeholder","Costo",3,"ngModelChange","onInput","minFractionDigits","ngModel"],["tooltipPosition","bottom","pTooltip","Utilidad",1,"p-inputgroup-addon"],["mode","decimal","locale","en-US","placeholder","Utilidad",3,"ngModelChange","minFractionDigits","ngModel","disabled"],["pTemplate","footer"],[1,"mr-3",2,"display","flex"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","size","20","placeholder","B\xFAsqueda...",2,"width","auto!important",3,"input"],["pTooltip","Agregar Producto","tooltipPosition","bottom","label","Agregar","icon","pi pi-external-link",1,"p-button-info","margen",3,"onClick","raised","loading","disabled"],["icon","pi pi-file","class","margen","pTooltip","Descargar CSV","tooltipPosition","bottom","severity","secondary",3,"disabled","onClick",4,"ngIf"],["icon","pi pi-file-excel","class","margen","pTooltip","Descargar Excel","tooltipPosition","bottom","severity","success",3,"disabled","onClick",4,"ngIf"],["icon","pi pi-file","pTooltip","Descargar CSV","tooltipPosition","bottom","severity","secondary",1,"margen",3,"onClick","disabled"],["icon","pi pi-file-excel","pTooltip","Descargar Excel","tooltipPosition","bottom","severity","success",1,"margen",3,"onClick","disabled"],["pResizableColumn","","style","width: 11em","class","text-center",3,"pSortableColumn",4,"ngFor","ngForOf"],["pResizableColumn","",1,"text-center",2,"width","11em",3,"pSortableColumn"],[3,"field"],[1,"animate__animated","animate__fadeInLeft"],[1,"text-center"],[3,"ngClass"],["pTooltip","Editar Producto","tooltipPosition","bottom","icon","pi pi-pencil","severity","success",1,"margen2",3,"onClick","rounded"],["pTooltip","Eliminar Producto","tooltipPosition","bottom","icon","pi pi-trash","severity","danger",1,"margen2",3,"onClick","rounded"],[1,"inline-flex","align-items-center","justify-content-center","gap-2"],["icon","pi pi-check","severity","primary",3,"raised","label","onClick",4,"ngIf"],["icon","pi pi-search","severity","success",3,"raised","label","onClick",4,"ngIf"],["icon","pi pi-eraser","severity","secondary",3,"onClick","raised","label"],["icon","pi pi-times","label","Cancelar","severity","danger",3,"onClick","raised"],["icon","pi pi-check","severity","primary",3,"onClick","raised","label"],["icon","pi pi-search","severity","success",3,"onClick","raised","label"]],template:function(i,t){if(i&1){let m=w();a(0,"div",1)(1,"p-table",2,0),x(3,ze,7,5,"ng-template",3)(4,Re,2,1,"ng-template",4)(5,Xe,18,21,"ng-template",5)(6,je,4,1,"ng-template",6),l()(),y(7,"ngx-spinner",7),a(8,"p-dialog",8),S("visibleChange",function(n){return u(m),I(t.visible,n)||(t.visible=n),_(n)}),x(9,Ze,3,1,"ng-template",9),a(10,"div",10)(11,"div",11)(12,"div",12)(13,"span",13),y(14,"i",14),l(),a(15,"input",15),S("ngModelChange",function(n){return u(m),I(t.nombreProd,n)||(t.nombreProd=n),_(n)}),l()()(),a(16,"div",11)(17,"p-dropdown",16),S("ngModelChange",function(n){return u(m),I(t.imp,n)||(t.imp=n),_(n)}),h("onChange",function(n){return u(m),_(t.handleOnChange(n))}),l()(),a(18,"div",17)(19,"div",12)(20,"span",18),y(21,"i",19),l(),a(22,"p-inputNumber",20),S("ngModelChange",function(n){return u(m),I(t.cantProd,n)||(t.cantProd=n),_(n)}),l()()(),a(23,"div",17)(24,"div",12)(25,"span",21),y(26,"i",22),l(),a(27,"p-inputNumber",23),S("ngModelChange",function(n){return u(m),I(t.precioProd,n)||(t.precioProd=n),_(n)}),h("onInput",function(n){return u(m),_(t.handleOnChangeInput(n))}),l()()(),a(28,"div",17)(29,"div",12)(30,"span",24),y(31,"i",22),l(),a(32,"p-inputNumber",25),S("ngModelChange",function(n){return u(m),I(t.gancProd,n)||(t.gancProd=n),_(n)}),l()()()(),x(33,Ge,4,5,"ng-template",26),l()}i&2&&(p(),d("tableStyle",M(33,Be))("value",t.info)("rows",t.filas)("loading",t.loading)("columns",t.columnas)("paginator",!0)("showCurrentPageReport",!0)("resizableColumns",!0)("rowsPerPageOptions",M(34,De))("globalFilterFields",M(35,Ne)),p(6),d("fullScreen",!0),p(),L(M(36,Fe)),v("visible",t.visible),d("modal",!0)("baseZIndex",1e4)("breakpoints",M(37,Oe))("draggable",!1)("resizable",!1),p(7),v("ngModel",t.nombreProd),p(2),d("options",t.listImp),v("ngModel",t.imp),d("filter",!0)("showClear",!0),p(5),d("showButtons",!0)("min",0)("max",1e3),v("ngModel",t.cantProd),p(5),d("minFractionDigits",2),v("ngModel",t.precioProd),p(5),d("minFractionDigits",2),v("ngModel",t.gancProd),d("disabled",t.gancProdDis))},dependencies:[le,te,q,j,Z,H,Y,G,ge,_e,ae,re,pe,se,ye,be,Ce,Pe,we,he,fe,Q,J,$,K,ve,oe,ie,ue,me,ce,de],styles:[".swal2-container{z-index:20000!important}.margen[_ngcontent-%COMP%]{margin-left:5px}.margen2[_ngcontent-%COMP%]{margin-right:.5rem}.outofstockzero[_ngcontent-%COMP%]{font-weight:700;color:#ff5252;text-decoration:line-through}.outofstock[_ngcontent-%COMP%]{font-weight:700;color:#ff5252}.lowstock[_ngcontent-%COMP%]{font-weight:700;color:#ffa726}.instock[_ngcontent-%COMP%]{font-weight:700;color:#66bb6a}.light-blue-backdrop[_ngcontent-%COMP%]{background-color:#5cb3fd}.product-image[_ngcontent-%COMP%]{width:50%;box-shadow:0 3px 6px #00000029,0 3px 6px #0000003b}"]});let r=c;return r})();export{yt as ProductosComponent};
